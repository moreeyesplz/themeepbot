{"version":3,"file":"index.js","sources":["../dist-src/get-app-authentication.js","../dist-src/cache.js","../dist-src/to-token-authentication.js","../dist-src/get-installation-authentication.js","../dist-src/get-oauth-authentication.js","../dist-src/auth.js","../dist-src/requires-app-auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { githubAppJwt } from \"universal-github-app-jwt\";\nexport async function getAppAuthentication(id, privateKey) {\n    const appAuthentication = await githubAppJwt({ id, privateKey });\n    return {\n        type: \"app\",\n        token: appAuthentication.token,\n        appId: appAuthentication.appId,\n        expiresAt: new Date(appAuthentication.expiration * 1000).toISOString(),\n    };\n}\n","// https://github.com/isaacs/node-lru-cache#readme\nimport LRU from \"lru-cache\";\nexport function getCache() {\n    return new LRU({\n        // cache max. 15000 tokens, that will use less than 10mb memory\n        max: 15000,\n        // Cache for 1 minute less than GitHub expiry\n        maxAge: 1000 * 60 * 59,\n    });\n}\nexport async function get(cache, options) {\n    const cacheKey = optionsToCacheKey(options);\n    const result = await cache.get(cacheKey);\n    if (!result) {\n        return;\n    }\n    const [token, createdAt, expiresAt, repositorySelection, permissionsString, singleFileName,] = result.split(\"|\");\n    const permissions = options.permissions ||\n        permissionsString.split(/,/).reduce((permissions, string) => {\n            if (/!$/.test(string)) {\n                permissions[string.slice(0, -1)] = \"write\";\n            }\n            else {\n                permissions[string] = \"read\";\n            }\n            return permissions;\n        }, {});\n    return {\n        token,\n        createdAt,\n        expiresAt,\n        permissions,\n        repositoryIds: options.repositoryIds,\n        singleFileName,\n        repositorySelection: repositorySelection,\n    };\n}\nexport async function set(cache, options, data) {\n    const key = optionsToCacheKey(options);\n    const permissionsString = options.permissions\n        ? \"\"\n        : Object.keys(data.permissions)\n            .map((name) => `${name}${data.permissions[name] === \"write\" ? \"!\" : \"\"}`)\n            .join(\",\");\n    const value = [\n        data.token,\n        data.createdAt,\n        data.expiresAt,\n        data.repositorySelection,\n        permissionsString,\n        data.singleFileName,\n    ].join(\"|\");\n    await cache.set(key, value);\n}\nfunction optionsToCacheKey({ installationId, permissions = {}, repositoryIds = [], }) {\n    const permissionsString = Object.keys(permissions)\n        .sort()\n        .map((name) => (permissions[name] === \"read\" ? name : `${name}!`))\n        .join(\",\");\n    const repositoryIdsString = repositoryIds.sort().join(\",\");\n    return [installationId, repositoryIdsString, permissionsString]\n        .filter(Boolean)\n        .join(\"|\");\n}\n","export function toTokenAuthentication({ installationId, token, createdAt, expiresAt, repositorySelection, permissions, repositoryIds, singleFileName, }) {\n    return Object.assign({\n        type: \"token\",\n        tokenType: \"installation\",\n        token,\n        installationId,\n        permissions,\n        createdAt,\n        expiresAt,\n        repositorySelection,\n    }, repositoryIds ? { repositoryIds } : null, singleFileName ? { singleFileName } : null);\n}\n","import { get, set } from \"./cache\";\nimport { getAppAuthentication } from \"./get-app-authentication\";\nimport { toTokenAuthentication } from \"./to-token-authentication\";\nexport async function getInstallationAuthentication(state, options, customRequest) {\n    const installationId = (options.installationId ||\n        state.installationId);\n    if (typeof installationId !== \"number\") {\n        throw new Error(\"[@octokit/auth-app] installationId option is required for installation authentication.\");\n    }\n    const optionsWithInstallationTokenFromState = Object.assign({ installationId }, options);\n    if (!options.refresh) {\n        const result = await get(state.cache, optionsWithInstallationTokenFromState);\n        if (result) {\n            const { token, createdAt, expiresAt, permissions, repositoryIds, singleFileName, repositorySelection, } = result;\n            return toTokenAuthentication({\n                installationId,\n                token,\n                createdAt,\n                expiresAt,\n                permissions,\n                repositorySelection,\n                repositoryIds,\n                singleFileName,\n            });\n        }\n    }\n    const appAuthentication = await getAppAuthentication(state.id, state.privateKey);\n    const request = customRequest || state.request;\n    const { data: { token, expires_at: expiresAt, repositories, permissions, \n    // @ts-ignore\n    repository_selection: repositorySelection, \n    // @ts-ignore\n    single_file: singleFileName, }, } = await request(\"POST /app/installations/:installation_id/access_tokens\", {\n        installation_id: installationId,\n        repository_ids: options.repositoryIds,\n        permissions: options.permissions,\n        mediaType: {\n            previews: [\"machine-man\"],\n        },\n        headers: {\n            authorization: `bearer ${appAuthentication.token}`,\n        },\n    });\n    const repositoryIds = repositories\n        ? repositories.map((r) => r.id)\n        : void 0;\n    const createdAt = new Date().toISOString();\n    await set(state.cache, optionsWithInstallationTokenFromState, {\n        token,\n        createdAt,\n        expiresAt,\n        repositorySelection,\n        permissions,\n        repositoryIds,\n        singleFileName,\n    });\n    return toTokenAuthentication({\n        installationId,\n        token,\n        createdAt,\n        expiresAt,\n        repositorySelection,\n        permissions,\n        repositoryIds,\n        singleFileName,\n    });\n}\n","import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAuthentication(state, options, customRequest) {\n    const request = customRequest || state.request;\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead itâ€™s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    const parameters = {\n        headers: {\n            accept: `application/json`,\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: options.code,\n        state: options.state,\n        redirect_uri: options.redirectUrl,\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters),\n        });\n    }\n    const { data: { access_token: token, scope }, } = response;\n    return {\n        type: \"token\",\n        tokenType: \"oauth\",\n        token,\n        scopes: scope.split(/,\\s*/).filter(Boolean),\n    };\n}\n","import { getAppAuthentication } from \"./get-app-authentication\";\nimport { getInstallationAuthentication } from \"./get-installation-authentication\";\nimport { getOAuthAuthentication } from \"./get-oauth-authentication\";\nexport async function auth(state, options) {\n    if (options.type === \"app\") {\n        return getAppAuthentication(state.id, state.privateKey);\n    }\n    if (options.type === \"installation\") {\n        return getInstallationAuthentication(state, options);\n    }\n    return getOAuthAuthentication(state, options);\n}\n","const PATHS = [\n    \"/app\",\n    \"/app/installations\",\n    \"/app/installations/:installation_id\",\n    \"/app/installations/:installation_id/access_tokens\",\n    \"/marketplace_listing/accounts/:account_id\",\n    \"/marketplace_listing/plan\",\n    \"/marketplace_listing/plans/:plan_id/accounts\",\n    \"/marketplace_listing/stubbed/accounts/:account_id\",\n    \"/marketplace_listing/stubbed/plan\",\n    \"/marketplace_listing/stubbed/plans/:plan_id/accounts\",\n    \"/orgs/:org/installation\",\n    \"/repos/:owner/:repo/installation\",\n    \"/users/:username/installation\",\n];\n// CREDIT: Simon Grondin (https://github.com/SGrondin)\n// https://github.com/octokit/plugin-throttling.js/blob/45c5d7f13b8af448a9dbca468d9c9150a73b3948/lib/route-matcher.js\nfunction routeMatcher(paths) {\n    // EXAMPLE. For the following paths:\n    /* [\n        \"/orgs/:org/invitations\",\n        \"/repos/:owner/:repo/collaborators/:username\"\n    ] */\n    const regexes = paths.map((p) => p\n        .split(\"/\")\n        .map((c) => (c.startsWith(\":\") ? \"(?:.+?)\" : c))\n        .join(\"/\"));\n    // 'regexes' would contain:\n    /* [\n        '/orgs/(?:.+?)/invitations',\n        '/repos/(?:.+?)/(?:.+?)/collaborators/(?:.+?)'\n    ] */\n    const regex = `^(?:${regexes.map((r) => `(?:${r})`).join(\"|\")})[^/]*$`;\n    // 'regex' would contain:\n    /*\n      ^(?:(?:\\/orgs\\/(?:.+?)\\/invitations)|(?:\\/repos\\/(?:.+?)\\/(?:.+?)\\/collaborators\\/(?:.+?)))[^\\/]*$\n  \n      It may look scary, but paste it into https://www.debuggex.com/\n      and it will make a lot more sense!\n    */\n    return new RegExp(regex, \"i\");\n}\nconst REGEX = routeMatcher(PATHS);\nexport function requiresAppAuth(url) {\n    return !!url && REGEX.test(url);\n}\n","import { getAppAuthentication } from \"./get-app-authentication\";\nimport { getInstallationAuthentication } from \"./get-installation-authentication\";\nimport { requiresAppAuth } from \"./requires-app-auth\";\nconst SIXTY_SECONDS_IN_MS = 60 * 1000;\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    if (requiresAppAuth(endpoint.url.replace(request.endpoint.DEFAULTS.baseUrl, \"\"))) {\n        const { token } = await getAppAuthentication(state.id, state.privateKey);\n        endpoint.headers.authorization = `bearer ${token}`;\n        return request(endpoint);\n    }\n    const { token, createdAt } = await getInstallationAuthentication(state, {}, request);\n    endpoint.headers.authorization = `token ${token}`;\n    return sendRequestWithRetries(request, endpoint, createdAt);\n}\n/**\n * Newly created tokens might not be accessible immediately after creation.\n * In case of a 401 response, we retry with an exponential delay until more\n * than one minute passes since the creation of the token.\n *\n * @see https://github.com/octokit/auth-app.js/issues/65\n */\nasync function sendRequestWithRetries(request, options, createdAt, retries = 0) {\n    const timeSinceTokenCreationInMs = +new Date() - +new Date(createdAt);\n    try {\n        return await request(options);\n    }\n    catch (error) {\n        if (error.status !== 401) {\n            throw error;\n        }\n        if (timeSinceTokenCreationInMs >= SIXTY_SECONDS_IN_MS) {\n            throw error;\n        }\n        ++retries;\n        const awaitTime = retries * retries * 1000;\n        console.warn(`[@octokit/auth-app] Retrying after 401 response to account for token replication delay (retry: ${retries}, wait: ${awaitTime}ms)`);\n        await new Promise((resolve) => setTimeout(resolve, awaitTime));\n        return sendRequestWithRetries(request, options, createdAt, retries);\n    }\n}\n","export const VERSION = \"2.4.14\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { getCache } from \"./cache\";\nimport { VERSION } from \"./version\";\nexport const createAppAuth = function createAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-app.js/${VERSION} ${getUserAgent()}`,\n            },\n        }),\n        cache: getCache(),\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state),\n    });\n};\n"],"names":["getAppAuthentication","id","privateKey","appAuthentication","githubAppJwt","type","token","appId","expiresAt","Date","expiration","toISOString","getCache","LRU","max","maxAge","get","cache","options","cacheKey","optionsToCacheKey","result","createdAt","repositorySelection","permissionsString","singleFileName","split","permissions","reduce","string","test","slice","repositoryIds","set","data","key","Object","keys","map","name","join","value","installationId","sort","repositoryIdsString","filter","Boolean","toTokenAuthentication","assign","tokenType","getInstallationAuthentication","state","customRequest","Error","optionsWithInstallationTokenFromState","refresh","request","expires_at","repositories","repository_selection","single_file","installation_id","repository_ids","mediaType","previews","headers","authorization","r","getOAuthAuthentication","route","endpoint","DEFAULTS","baseUrl","replace","parameters","accept","client_id","clientId","client_secret","clientSecret","code","redirect_uri","redirectUrl","response","error","undefined","RequestError","error_description","status","access_token","scope","scopes","auth","PATHS","routeMatcher","paths","regexes","p","c","startsWith","regex","RegExp","REGEX","requiresAppAuth","url","SIXTY_SECONDS_IN_MS","hook","merge","sendRequestWithRetries","retries","timeSinceTokenCreationInMs","awaitTime","console","warn","Promise","resolve","setTimeout","VERSION","createAppAuth","defaults","getUserAgent","bind"],"mappings":";;;;;;;;;;;;AACO,eAAeA,oBAAf,CAAoCC,EAApC,EAAwCC,UAAxC,EAAoD;AACvD,QAAMC,iBAAiB,GAAG,MAAMC,kCAAY,CAAC;AAAEH,IAAAA,EAAF;AAAMC,IAAAA;AAAN,GAAD,CAA5C;AACA,SAAO;AACHG,IAAAA,IAAI,EAAE,KADH;AAEHC,IAAAA,KAAK,EAAEH,iBAAiB,CAACG,KAFtB;AAGHC,IAAAA,KAAK,EAAEJ,iBAAiB,CAACI,KAHtB;AAIHC,IAAAA,SAAS,EAAE,IAAIC,IAAJ,CAASN,iBAAiB,CAACO,UAAlB,GAA+B,IAAxC,EAA8CC,WAA9C;AAJR,GAAP;AAMH;;ACTD;AACA,AACO,SAASC,QAAT,GAAoB;AACvB,SAAO,IAAIC,GAAJ,CAAQ;AACX;AACAC,IAAAA,GAAG,EAAE,KAFM;AAGX;AACAC,IAAAA,MAAM,EAAE,OAAO,EAAP,GAAY;AAJT,GAAR,CAAP;AAMH;AACD,AAAO,eAAeC,GAAf,CAAmBC,KAAnB,EAA0BC,OAA1B,EAAmC;AACtC,QAAMC,QAAQ,GAAGC,iBAAiB,CAACF,OAAD,CAAlC;AACA,QAAMG,MAAM,GAAG,MAAMJ,KAAK,CAACD,GAAN,CAAUG,QAAV,CAArB;;AACA,MAAI,CAACE,MAAL,EAAa;AACT;AACH;;AACD,QAAM,CAACf,KAAD,EAAQgB,SAAR,EAAmBd,SAAnB,EAA8Be,mBAA9B,EAAmDC,iBAAnD,EAAsEC,cAAtE,IAAyFJ,MAAM,CAACK,KAAP,CAAa,GAAb,CAA/F;AACA,QAAMC,WAAW,GAAGT,OAAO,CAACS,WAAR,IAChBH,iBAAiB,CAACE,KAAlB,CAAwB,GAAxB,EAA6BE,MAA7B,CAAoC,CAACD,WAAD,EAAcE,MAAd,KAAyB;AACzD,QAAI,KAAKC,IAAL,CAAUD,MAAV,CAAJ,EAAuB;AACnBF,MAAAA,WAAW,CAACE,MAAM,CAACE,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAD,CAAX,GAAmC,OAAnC;AACH,KAFD,MAGK;AACDJ,MAAAA,WAAW,CAACE,MAAD,CAAX,GAAsB,MAAtB;AACH;;AACD,WAAOF,WAAP;AACH,GARD,EAQG,EARH,CADJ;AAUA,SAAO;AACHrB,IAAAA,KADG;AAEHgB,IAAAA,SAFG;AAGHd,IAAAA,SAHG;AAIHmB,IAAAA,WAJG;AAKHK,IAAAA,aAAa,EAAEd,OAAO,CAACc,aALpB;AAMHP,IAAAA,cANG;AAOHF,IAAAA,mBAAmB,EAAEA;AAPlB,GAAP;AASH;AACD,AAAO,eAAeU,GAAf,CAAmBhB,KAAnB,EAA0BC,OAA1B,EAAmCgB,IAAnC,EAAyC;AAC5C,QAAMC,GAAG,GAAGf,iBAAiB,CAACF,OAAD,CAA7B;AACA,QAAMM,iBAAiB,GAAGN,OAAO,CAACS,WAAR,GACpB,EADoB,GAEpBS,MAAM,CAACC,IAAP,CAAYH,IAAI,CAACP,WAAjB,EACGW,GADH,CACQC,IAAD,IAAW,GAAEA,IAAK,GAAEL,IAAI,CAACP,WAAL,CAAiBY,IAAjB,MAA2B,OAA3B,GAAqC,GAArC,GAA2C,EAAG,EADzE,EAEGC,IAFH,CAEQ,GAFR,CAFN;AAKA,QAAMC,KAAK,GAAG,CACVP,IAAI,CAAC5B,KADK,EAEV4B,IAAI,CAACZ,SAFK,EAGVY,IAAI,CAAC1B,SAHK,EAIV0B,IAAI,CAACX,mBAJK,EAKVC,iBALU,EAMVU,IAAI,CAACT,cANK,EAOZe,IAPY,CAOP,GAPO,CAAd;AAQA,QAAMvB,KAAK,CAACgB,GAAN,CAAUE,GAAV,EAAeM,KAAf,CAAN;AACH;;AACD,SAASrB,iBAAT,CAA2B;AAAEsB,EAAAA,cAAF;AAAkBf,EAAAA,WAAW,GAAG,EAAhC;AAAoCK,EAAAA,aAAa,GAAG;AAApD,CAA3B,EAAsF;AAClF,QAAMR,iBAAiB,GAAGY,MAAM,CAACC,IAAP,CAAYV,WAAZ,EACrBgB,IADqB,GAErBL,GAFqB,CAEhBC,IAAD,IAAWZ,WAAW,CAACY,IAAD,CAAX,KAAsB,MAAtB,GAA+BA,IAA/B,GAAuC,GAAEA,IAAK,GAFxC,EAGrBC,IAHqB,CAGhB,GAHgB,CAA1B;AAIA,QAAMI,mBAAmB,GAAGZ,aAAa,CAACW,IAAd,GAAqBH,IAArB,CAA0B,GAA1B,CAA5B;AACA,SAAO,CAACE,cAAD,EAAiBE,mBAAjB,EAAsCpB,iBAAtC,EACFqB,MADE,CACKC,OADL,EAEFN,IAFE,CAEG,GAFH,CAAP;AAGH;;AC/DM,SAASO,qBAAT,CAA+B;AAAEL,EAAAA,cAAF;AAAkBpC,EAAAA,KAAlB;AAAyBgB,EAAAA,SAAzB;AAAoCd,EAAAA,SAApC;AAA+Ce,EAAAA,mBAA/C;AAAoEI,EAAAA,WAApE;AAAiFK,EAAAA,aAAjF;AAAgGP,EAAAA;AAAhG,CAA/B,EAAkJ;AACrJ,SAAOW,MAAM,CAACY,MAAP,CAAc;AACjB3C,IAAAA,IAAI,EAAE,OADW;AAEjB4C,IAAAA,SAAS,EAAE,cAFM;AAGjB3C,IAAAA,KAHiB;AAIjBoC,IAAAA,cAJiB;AAKjBf,IAAAA,WALiB;AAMjBL,IAAAA,SANiB;AAOjBd,IAAAA,SAPiB;AAQjBe,IAAAA;AARiB,GAAd,EASJS,aAAa,GAAG;AAAEA,IAAAA;AAAF,GAAH,GAAuB,IAThC,EASsCP,cAAc,GAAG;AAAEA,IAAAA;AAAF,GAAH,GAAwB,IAT5E,CAAP;AAUH;;ACRM,eAAeyB,6BAAf,CAA6CC,KAA7C,EAAoDjC,OAApD,EAA6DkC,aAA7D,EAA4E;AAC/E,QAAMV,cAAc,GAAIxB,OAAO,CAACwB,cAAR,IACpBS,KAAK,CAACT,cADV;;AAEA,MAAI,OAAOA,cAAP,KAA0B,QAA9B,EAAwC;AACpC,UAAM,IAAIW,KAAJ,CAAU,wFAAV,CAAN;AACH;;AACD,QAAMC,qCAAqC,GAAGlB,MAAM,CAACY,MAAP,CAAc;AAAEN,IAAAA;AAAF,GAAd,EAAkCxB,OAAlC,CAA9C;;AACA,MAAI,CAACA,OAAO,CAACqC,OAAb,EAAsB;AAClB,UAAMlC,MAAM,GAAG,MAAML,GAAG,CAACmC,KAAK,CAAClC,KAAP,EAAcqC,qCAAd,CAAxB;;AACA,QAAIjC,MAAJ,EAAY;AACR,YAAM;AAAEf,QAAAA,KAAF;AAASgB,QAAAA,SAAT;AAAoBd,QAAAA,SAApB;AAA+BmB,QAAAA,WAA/B;AAA4CK,QAAAA,aAA5C;AAA2DP,QAAAA,cAA3D;AAA2EF,QAAAA;AAA3E,UAAoGF,MAA1G;AACA,aAAO0B,qBAAqB,CAAC;AACzBL,QAAAA,cADyB;AAEzBpC,QAAAA,KAFyB;AAGzBgB,QAAAA,SAHyB;AAIzBd,QAAAA,SAJyB;AAKzBmB,QAAAA,WALyB;AAMzBJ,QAAAA,mBANyB;AAOzBS,QAAAA,aAPyB;AAQzBP,QAAAA;AARyB,OAAD,CAA5B;AAUH;AACJ;;AACD,QAAMtB,iBAAiB,GAAG,MAAMH,oBAAoB,CAACmD,KAAK,CAAClD,EAAP,EAAWkD,KAAK,CAACjD,UAAjB,CAApD;AACA,QAAMsD,OAAO,GAAGJ,aAAa,IAAID,KAAK,CAACK,OAAvC;AACA,QAAM;AAAEtB,IAAAA,IAAI,EAAE;AAAE5B,MAAAA,KAAF;AAASmD,MAAAA,UAAU,EAAEjD,SAArB;AAAgCkD,MAAAA,YAAhC;AAA8C/B,MAAAA,WAA9C;AACd;AACAgC,MAAAA,oBAAoB,EAAEpC,mBAFR;AAGd;AACAqC,MAAAA,WAAW,EAAEnC;AAJC;AAAR,MAI8B,MAAM+B,OAAO,CAAC,wDAAD,EAA2D;AACxGK,IAAAA,eAAe,EAAEnB,cADuF;AAExGoB,IAAAA,cAAc,EAAE5C,OAAO,CAACc,aAFgF;AAGxGL,IAAAA,WAAW,EAAET,OAAO,CAACS,WAHmF;AAIxGoC,IAAAA,SAAS,EAAE;AACPC,MAAAA,QAAQ,EAAE,CAAC,aAAD;AADH,KAJ6F;AAOxGC,IAAAA,OAAO,EAAE;AACLC,MAAAA,aAAa,EAAG,UAAS/D,iBAAiB,CAACG,KAAM;AAD5C;AAP+F,GAA3D,CAJjD;AAeA,QAAM0B,aAAa,GAAG0B,YAAY,GAC5BA,YAAY,CAACpB,GAAb,CAAkB6B,CAAD,IAAOA,CAAC,CAAClE,EAA1B,CAD4B,GAE5B,KAAK,CAFX;AAGA,QAAMqB,SAAS,GAAG,IAAIb,IAAJ,GAAWE,WAAX,EAAlB;AACA,QAAMsB,GAAG,CAACkB,KAAK,CAAClC,KAAP,EAAcqC,qCAAd,EAAqD;AAC1DhD,IAAAA,KAD0D;AAE1DgB,IAAAA,SAF0D;AAG1Dd,IAAAA,SAH0D;AAI1De,IAAAA,mBAJ0D;AAK1DI,IAAAA,WAL0D;AAM1DK,IAAAA,aAN0D;AAO1DP,IAAAA;AAP0D,GAArD,CAAT;AASA,SAAOsB,qBAAqB,CAAC;AACzBL,IAAAA,cADyB;AAEzBpC,IAAAA,KAFyB;AAGzBgB,IAAAA,SAHyB;AAIzBd,IAAAA,SAJyB;AAKzBe,IAAAA,mBALyB;AAMzBI,IAAAA,WANyB;AAOzBK,IAAAA,aAPyB;AAQzBP,IAAAA;AARyB,GAAD,CAA5B;AAUH;;ACjEM,eAAe2C,sBAAf,CAAsCjB,KAAtC,EAA6CjC,OAA7C,EAAsDkC,aAAtD,EAAqE;AACxE,QAAMI,OAAO,GAAGJ,aAAa,IAAID,KAAK,CAACK,OAAvC,CADwE;AAGxE;;AACA,QAAMa,KAAK,GAAG,kCAAkCvC,IAAlC,CAAuCqB,KAAK,CAACK,OAAN,CAAcc,QAAd,CAAuBC,QAAvB,CAAgCC,OAAvE,IACR,kDADQ,GAEP,QAAOrB,KAAK,CAACK,OAAN,CAAcc,QAAd,CAAuBC,QAAvB,CAAgCC,OAAhC,CAAwCC,OAAxC,CAAgD,SAAhD,EAA2D,2BAA3D,CAAwF,EAFtG;AAGA,QAAMC,UAAU,GAAG;AACfT,IAAAA,OAAO,EAAE;AACLU,MAAAA,MAAM,EAAG;AADJ,KADM;AAIfC,IAAAA,SAAS,EAAEzB,KAAK,CAAC0B,QAJF;AAKfC,IAAAA,aAAa,EAAE3B,KAAK,CAAC4B,YALN;AAMfC,IAAAA,IAAI,EAAE9D,OAAO,CAAC8D,IANC;AAOf7B,IAAAA,KAAK,EAAEjC,OAAO,CAACiC,KAPA;AAQf8B,IAAAA,YAAY,EAAE/D,OAAO,CAACgE;AARP,GAAnB;AAUA,QAAMC,QAAQ,GAAG,MAAM3B,OAAO,CAACa,KAAD,EAAQK,UAAR,CAA9B;;AACA,MAAIS,QAAQ,CAACjD,IAAT,CAAckD,KAAd,KAAwBC,SAA5B,EAAuC;AACnC,UAAM,IAAIC,yBAAJ,CAAkB,GAAEH,QAAQ,CAACjD,IAAT,CAAcqD,iBAAkB,KAAIJ,QAAQ,CAACjD,IAAT,CAAckD,KAAM,GAA5E,EAAgFD,QAAQ,CAACK,MAAzF,EAAiG;AACnGvB,MAAAA,OAAO,EAAEkB,QAAQ,CAAClB,OADiF;AAEnGT,MAAAA,OAAO,EAAEA,OAAO,CAACc,QAAR,CAAiBD,KAAjB,EAAwBK,UAAxB;AAF0F,KAAjG,CAAN;AAIH;;AACD,QAAM;AAAExC,IAAAA,IAAI,EAAE;AAAEuD,MAAAA,YAAY,EAAEnF,KAAhB;AAAuBoF,MAAAA;AAAvB;AAAR,MAA4CP,QAAlD;AACA,SAAO;AACH9E,IAAAA,IAAI,EAAE,OADH;AAEH4C,IAAAA,SAAS,EAAE,OAFR;AAGH3C,IAAAA,KAHG;AAIHqF,IAAAA,MAAM,EAAED,KAAK,CAAChE,KAAN,CAAY,MAAZ,EAAoBmB,MAApB,CAA2BC,OAA3B;AAJL,GAAP;AAMH;;AC7BM,eAAe8C,IAAf,CAAoBzC,KAApB,EAA2BjC,OAA3B,EAAoC;AACvC,MAAIA,OAAO,CAACb,IAAR,KAAiB,KAArB,EAA4B;AACxB,WAAOL,oBAAoB,CAACmD,KAAK,CAAClD,EAAP,EAAWkD,KAAK,CAACjD,UAAjB,CAA3B;AACH;;AACD,MAAIgB,OAAO,CAACb,IAAR,KAAiB,cAArB,EAAqC;AACjC,WAAO6C,6BAA6B,CAACC,KAAD,EAAQjC,OAAR,CAApC;AACH;;AACD,SAAOkD,sBAAsB,CAACjB,KAAD,EAAQjC,OAAR,CAA7B;AACH;;ACXD,MAAM2E,KAAK,GAAG,CACV,MADU,EAEV,oBAFU,EAGV,qCAHU,EAIV,mDAJU,EAKV,2CALU,EAMV,2BANU,EAOV,8CAPU,EAQV,mDARU,EASV,mCATU,EAUV,sDAVU,EAWV,yBAXU,EAYV,kCAZU,EAaV,+BAbU,CAAd;AAgBA;;AACA,SAASC,YAAT,CAAsBC,KAAtB,EAA6B;AACzB;;AACA;;;;AAIA,QAAMC,OAAO,GAAGD,KAAK,CAACzD,GAAN,CAAW2D,CAAD,IAAOA,CAAC,CAC7BvE,KAD4B,CACtB,GADsB,EAE5BY,GAF4B,CAEvB4D,CAAD,IAAQA,CAAC,CAACC,UAAF,CAAa,GAAb,IAAoB,SAApB,GAAgCD,CAFhB,EAG5B1D,IAH4B,CAGvB,GAHuB,CAAjB,CAAhB,CANyB;;AAWzB;;;;;AAIA,QAAM4D,KAAK,GAAI,OAAMJ,OAAO,CAAC1D,GAAR,CAAa6B,CAAD,IAAQ,MAAKA,CAAE,GAA3B,EAA+B3B,IAA/B,CAAoC,GAApC,CAAyC,SAA9D,CAfyB;;AAiBzB;;;;;;AAMA,SAAO,IAAI6D,MAAJ,CAAWD,KAAX,EAAkB,GAAlB,CAAP;AACH;;AACD,MAAME,KAAK,GAAGR,YAAY,CAACD,KAAD,CAA1B;AACA,AAAO,SAASU,eAAT,CAAyBC,GAAzB,EAA8B;AACjC,SAAO,CAAC,CAACA,GAAF,IAASF,KAAK,CAACxE,IAAN,CAAW0E,GAAX,CAAhB;AACH;;AC1CD,MAAMC,mBAAmB,GAAG,KAAK,IAAjC;AACA,AAAO,eAAeC,IAAf,CAAoBvD,KAApB,EAA2BK,OAA3B,EAAoCa,KAApC,EAA2CK,UAA3C,EAAuD;AAC1D,MAAIJ,QAAQ,GAAGd,OAAO,CAACc,QAAR,CAAiBqC,KAAjB,CAAuBtC,KAAvB,EAA8BK,UAA9B,CAAf;;AACA,MAAI6B,eAAe,CAACjC,QAAQ,CAACkC,GAAT,CAAa/B,OAAb,CAAqBjB,OAAO,CAACc,QAAR,CAAiBC,QAAjB,CAA0BC,OAA/C,EAAwD,EAAxD,CAAD,CAAnB,EAAkF;AAC9E,UAAM;AAAElE,MAAAA;AAAF,QAAY,MAAMN,oBAAoB,CAACmD,KAAK,CAAClD,EAAP,EAAWkD,KAAK,CAACjD,UAAjB,CAA5C;AACAoE,IAAAA,QAAQ,CAACL,OAAT,CAAiBC,aAAjB,GAAkC,UAAS5D,KAAM,EAAjD;AACA,WAAOkD,OAAO,CAACc,QAAD,CAAd;AACH;;AACD,QAAM;AAAEhE,IAAAA,KAAF;AAASgB,IAAAA;AAAT,MAAuB,MAAM4B,6BAA6B,CAACC,KAAD,EAAQ,EAAR,EAAYK,OAAZ,CAAhE;AACAc,EAAAA,QAAQ,CAACL,OAAT,CAAiBC,aAAjB,GAAkC,SAAQ5D,KAAM,EAAhD;AACA,SAAOsG,sBAAsB,CAACpD,OAAD,EAAUc,QAAV,EAAoBhD,SAApB,CAA7B;AACH;AACD;;;;;;;;AAOA,eAAesF,sBAAf,CAAsCpD,OAAtC,EAA+CtC,OAA/C,EAAwDI,SAAxD,EAAmEuF,OAAO,GAAG,CAA7E,EAAgF;AAC5E,QAAMC,0BAA0B,GAAG,CAAC,IAAIrG,IAAJ,EAAD,GAAc,CAAC,IAAIA,IAAJ,CAASa,SAAT,CAAlD;;AACA,MAAI;AACA,WAAO,MAAMkC,OAAO,CAACtC,OAAD,CAApB;AACH,GAFD,CAGA,OAAOkE,KAAP,EAAc;AACV,QAAIA,KAAK,CAACI,MAAN,KAAiB,GAArB,EAA0B;AACtB,YAAMJ,KAAN;AACH;;AACD,QAAI0B,0BAA0B,IAAIL,mBAAlC,EAAuD;AACnD,YAAMrB,KAAN;AACH;;AACD,MAAEyB,OAAF;AACA,UAAME,SAAS,GAAGF,OAAO,GAAGA,OAAV,GAAoB,IAAtC;AACAG,IAAAA,OAAO,CAACC,IAAR,CAAc,kGAAiGJ,OAAQ,WAAUE,SAAU,KAA3I;AACA,UAAM,IAAIG,OAAJ,CAAaC,OAAD,IAAaC,UAAU,CAACD,OAAD,EAAUJ,SAAV,CAAnC,CAAN;AACA,WAAOH,sBAAsB,CAACpD,OAAD,EAAUtC,OAAV,EAAmBI,SAAnB,EAA8BuF,OAA9B,CAA7B;AACH;AACJ;;ACxCM,MAAMQ,OAAO,GAAG,mBAAhB;;MCMMC,aAAa,GAAG,SAASA,aAAT,CAAuBpG,OAAvB,EAAgC;AACzD,QAAMiC,KAAK,GAAGf,MAAM,CAACY,MAAP,CAAc;AACxBQ,IAAAA,OAAO,EAAEA,eAAO,CAAC+D,QAAR,CAAiB;AACtBtD,MAAAA,OAAO,EAAE;AACL,sBAAe,uBAAsBoD,OAAQ,IAAGG,+BAAY,EAAG;AAD1D;AADa,KAAjB,CADe;AAMxBvG,IAAAA,KAAK,EAAEL,QAAQ;AANS,GAAd,EAOXM,OAPW,CAAd;AAQA,SAAOkB,MAAM,CAACY,MAAP,CAAc4C,IAAI,CAAC6B,IAAL,CAAU,IAAV,EAAgBtE,KAAhB,CAAd,EAAsC;AACzCuD,IAAAA,IAAI,EAAEA,IAAI,CAACe,IAAL,CAAU,IAAV,EAAgBtE,KAAhB;AADmC,GAAtC,CAAP;AAGH,CAZM;;;;"}